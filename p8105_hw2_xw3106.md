p8105_hw2_xw3106
================

``` r
#import library
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.0.4     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(readxl)
library(lubridate)
```

\#Problem 1

``` r
#read files
pols <- read_csv("fivethirtyeight_datasets/pols-month.csv")
```

    ## Rows: 822 Columns: 9
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
snp <- read_csv("fivethirtyeight_datasets/snp.csv")
```

    ## Rows: 787 Columns: 2
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (1): date
    ## dbl (1): close
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
unemployment <- read_csv("fivethirtyeight_datasets/unemployment.csv")
```

    ## Rows: 68 Columns: 13
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (13): Year, Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
#clean data in pols-month.csv
pols_clean <- pols |>
  janitor::clean_names() |>
  separate(mon, c("year", "month", "day"),convert= TRUE) |>
  mutate(month = factor(month.name[month],levels = month.name),
         president = if_else(prez_gop == 1, "gop", "dem")) |>
  select(year, month, president, everything(),-prez_gop, -prez_dem, -day)|>
  arrange(year, month)

#clean data in snp.csv
snp_clean <- snp |>
  janitor::clean_names() |>
  separate(date, c("month", "day", "year"), sep = "/", convert = TRUE) |>
  mutate(month = factor(month.name[month],levels = month.name),
         year = if_else(year <= 30, year + 2000, year + 1900)) |>
  select(year, month, everything(), -day)|>
  arrange(year, month)

#clean data in unemployment.csv
unemp_clean <- unemployment |>
  janitor::clean_names() |>
  pivot_longer(
    jan:dec,
    names_to  = "month",
    values_to = "unemployment") |>
  mutate(
    month = factor(month, levels = tolower(month.abb), labels = month.name))|>
  arrange(year, month)

#merge data sets
df = left_join(pols_clean, snp_clean, by = c("year", "month")) |>
  left_join(unemp_clean, by = c("year", "month"))
```

\#Problem 2

``` r
#Data Cleaning
#read Mr. Trash Wheel sheet
mr_trash_df = read_excel("202409 Trash Wheel Collection Data.xlsx",
                sheet = "Mr. Trash Wheel",
                range = "A2:M655")|>
  janitor::clean_names()|>
  filter(!is.na(weight_tons)& !is.na(dumpster))|>
  mutate(sports_balls = as.integer(round(sports_balls)),
         year = as.integer(year),
         wheel = "Mr. Trash Wheel",
         day = lubridate::day(date))|>
  select(wheel,dumpster,year,month,day,everything(),-date)

#read Professor Trash Wheel 
professor_trash_df = read_excel("202409 Trash Wheel Collection Data.xlsx",
                sheet = "Professor Trash Wheel",
                range = "A2:L125")|>
  janitor::clean_names()|>
  filter(!is.na(weight_tons)& !is.na(dumpster))|>
  mutate(wheel = "Professor Trash Wheel",
         year = as.integer(year),
         day = lubridate::day(date))|>
  select(wheel,dumpster,year,month,day,everything(),-date)

#read Gwynnda Trash Wheel 
gwynnda_trash_df = read_excel("202409 Trash Wheel Collection Data.xlsx",
                sheet = "Gwynnda Trash Wheel",
                range = "A2:K266")|>
  janitor::clean_names()|>
  filter(!is.na(weight_tons)& !is.na(dumpster))|>
  mutate(wheel = "Gwynnda Wheel",
         year = as.integer(year),
         day = lubridate::day(date))|>
  select(wheel,dumpster,year,month,day,everything(),-date)

#bind rows
trashwheel_df = bind_rows(mr_trash_df, professor_trash_df, gwynnda_trash_df)
```

`trashwheel_df` is the combined datasets for
`mr_trash_df`,`professor_trash_df`,`gwynnda_trash_df`. It have
1032observations of 14 variables. This dataset includes `wheel`, `year`,
`month`, `weight tons`. Also includes `<dbl>` variables such as
`plastic_bottles`, `polystyrene`… to show the quantity of different type
of trash. Variable `sports_balls` only exists in `mr_trash_wheel`. The
total weight collected by professor trash wheel is 246.74. In June of
2022, the gwynnda trash wheel picked up 18120 cigarette buts.

\#problem 3

``` r
#read data
zipcode = read.csv("zillow_data/Zip Codes.csv")
zori = read.csv("zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv")

#handling with data
zori_df = zori |>
  pivot_longer(
    X2015.01.31:X2024.08.31,
    names_to = "date",
    values_to = "rent"
  )|>
  janitor::clean_names()|>
  rename(zip_code = region_name,
         county = county_name)|>
  mutate(county = word(county, 1, -2))|>
  filter(!is.na(rent))

zipcode_df = zipcode |>
  select(-County.Code, -State.FIPS,-County.FIPS,File.Date) |>
  janitor::clean_names() 

#merge data sets
merged_df = left_join(zori_df, zipcode_df, by = c("zip_code", "county"))
```

Before merging the data, I decided to drop `county code`,
`state fips`,`county_fips`, `files date`. Variable `county` is enough to
cover since each county have their unique set value for `county code`,
`state fips`,`county_fips`. It is unnecessary to keep the three
variables. As for `file dates`, it does not give any meaning towards the
data. I merged the two data set based on `zip_code` and `county` because
for some of the zipcode contains 2 county, in this way, it prevent
duplication due to from joining many to many data.

``` r
#clean merged data
merged_df_clean <- merged_df |>
  mutate(
    date = str_remove(date, "^X"),
    borough = case_match(
      county,
      "New York" ~ "Manhattan",
      "Kings" ~ "Brooklyn",
      "Queens" ~ "Queens",
      "Bronx" ~ "Bronx",
      "Richmond" ~ "Staten Island")
    )|>
  select(
    zip_code, borough, neighborhood, 
    date, rent, 
    -state_name, -state, -city, -metro,-region_type,-region_id)
```

The tidy dataset contains 10450 observations of5 variables. There are
149 unique zipcode included and 43 unique neighborhood.

``` r
#Finding missing zip
missing_zip <- setdiff(
  zipcode_df |> distinct(zip_code) |> pull(zip_code),
  merged_df  |> distinct(zip_code) |> pull(zip_code)
)
```

There are320 unique zipcode in zipcode dataset, and 149in the Zillow
Rental Price dataset. For example, zip code 10464, 10474, 10475, 10499,
10550, 10704, 10705, 10803, 11202, 11224 … are missing. The reason these
zip code may not be included is because the corresponded area does not
have any rental market activitys. For example, those areas might be
industrial zone that does not have rental, or they might belong to the
suburbs or suburban, or the zip code might not belong to any
neighborhood. Some detailed exaple is `11430` is the zip code for JFK
airport, `11371` is the zip for LGA airport. These airports does not
belong to any neighborhood and cannot possibly have any rental
activities.

``` r
price_drop <- merged_df_clean |>
  filter(date %in% c("2020.01.31", "2021.01.31")) |>
  pivot_wider(names_from = date, values_from = rent) |>
  mutate(drop = `2020.01.31` - `2021.01.31`)|>
  arrange(desc(drop))

head(price_drop, 10)
```

    ## # A tibble: 10 × 6
    ##    zip_code borough   neighborhood               `2020.01.31` `2021.01.31`  drop
    ##       <int> <chr>     <chr>                             <dbl>        <dbl> <dbl>
    ##  1    10007 Manhattan Lower Manhattan                   6334.        5422.  913.
    ##  2    10069 Manhattan <NA>                              4623.        3875.  748.
    ##  3    10009 Manhattan Lower East Side                   3406.        2692.  714.
    ##  4    10016 Manhattan Gramercy Park and Murray …        3731.        3019.  712.
    ##  5    10001 Manhattan Chelsea and Clinton               4108.        3398.  710.
    ##  6    10002 Manhattan Lower East Side                   3645.        2935.  710.
    ##  7    10004 Manhattan Lower Manhattan                   3150.        2444.  706.
    ##  8    10038 Manhattan Lower Manhattan                   3573.        2876.  698.
    ##  9    10012 Manhattan Greenwich Village and Soho        3629.        2942.  686.
    ## 10    10010 Manhattan Gramercy Park and Murray …        3697.        3012.  685.

From this table, we can see that the top fluctuated price areas are in
Manhattan. Zipcode 10069 with NA value for neighborhood is in Upper West
Side. Among these top ten drops, rental price declines are concentrated
in Lower Manhattan and surrounding areas.
